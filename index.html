<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Media Cybersecurity Simulator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React Libraries -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel to compile JSX in browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-gray-900 text-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // --- FROM types.ts ---
    const SimulationStatus = Object.freeze({
      Stopped: 'stopped',
      Running: 'running',
      Paused: 'paused',
      Finished: 'finished',
    });

    // --- FROM constants.ts ---
  const INITIAL_SCHEDULED_POSTS = [
  {
    "emitter": "Claire",
    "handle": "@clairette",
    "message": "C'est moi ou il y a plus de monde que d'habitude à l'hopital ? ",
    "time": 1,
    "id": 1762426787701,
    "avatar": "https://picsum.photos/seed/@clairette/48/48",
    "likes": 0,
    "retweets": 0,
    "views": 0
  },
  {
    "id": 1,
    "emitter": "Marie",
    "handle": "@marie_p",
    "message": "Le site de l'hôpital ne répond plus, impossible de prendre un rendez-vous en ligne. Quelqu’un a des infos ?",
    "time": 3,
    "avatar": "https://picsum.photos/seed/marie_p/48/48",
    "likes": 15,
    "retweets": 5,
    "views": 850
  },
  {
    "id": 2,
    "emitter": "Patient aux urgences",
    "handle": "@antoine75",
    "message": "On vient de nous annoncer que les dossiers sont inaccessibles, attente interminable aux urgences. Quelqu’un confirme ?",
    "time": 7,
    "avatar": "https://picsum.photos/seed/antoine75/48/48",
    "likes": 32,
    "retweets": 12,
    "views": 1200
  },
  {
    "id": 3,
    "emitter": "Journal local",
    "handle": "@InfosVille",
    "message": "Alerte : perturbations massives signalées au CH de Bormontoires, services administratifs touchés. Nous recherchons des précisions.",
    "time": 12,
    "avatar": "https://picsum.photos/seed/InfosVille/48/48",
    "likes": 150,
    "retweets": 95,
    "views": 10500
  },
  {
    "id": 4,
    "emitter": "Parent d’un enfant hospitalisé",
    "handle": "@papa_en_attente",
    "message": "On vient de nous dire d’apporter nos propres papiers car l’accueil n’a plus accès aux dossiers. C’est inquiétant…",
    "time": 18,
    "avatar": "https://picsum.photos/seed/papa_en_attente/48/48",
    "likes": 45,
    "retweets": 18,
    "views": 2300
  },
  {
    "id": 5,
    "emitter": "Infirmière (service)",
    "handle": "@infirmiere_clem",
    "message": "On est obligés d’écrire tout à la main, transferts et comptes rendus bloqués. Trop de risques pour la sécurité des patients si ça dure.",
    "time": 25,
    "avatar": "https://picsum.photos/seed/infirmiere_clem/48/48",
    "likes": 250,
    "retweets": 80,
    "views": 15000
  },
  {
    "id": 6,
    "emitter": "Ambulancier",
    "handle": "@SAMU_rouge",
    "message": "Plusieurs ambulances sont redirigées : on refuse certains transferts tant que l’hôpital ne peut pas garantir la prise en charge.",
    "time": 30,
    "avatar": "https://picsum.photos/seed/SAMU_rouge/48/48",
    "likes": 320,
    "retweets": 180,
    "views": 22000
  },
  {
    "id": 7,
    "emitter": "Compte citoyen viral",
    "handle": "@veille_urbain",
    "message": "Témoignages d’opérations reportées, familles empilées dans les salles d’attente. Si c’est une attaque, c’est sérieux.",
    "time": 36,
    "avatar": "https://picsum.photos/seed/veille_urbain/48/48",
    "likes": 800,
    "retweets": 450,
    "views": 55000
  },
  {
    "id": 8,
    "emitter": "Blogueur santé",
    "handle": "@sante_connectee",
    "message": "Si les résultats et imageries sont inaccessibles, certains actes ne pourront pas être réalisés. Gros risque de cascade d’effets.",
    "time": 42,
    "avatar": "https://picsum.photos/seed/sante_connectee/48/48",
    "likes": 450,
    "retweets": 220,
    "views": 35000
  },
  {
    "id": 9,
    "emitter": "Journal régional",
    "handle": "@ActuRegion",
    "message": "Plusieurs rendez-vous annulés cet après-midi au CH de Bormontoires. Les patients sont priés de contacter leur médecin traitant.",
    "time": 50,
    "avatar": "https://picsum.photos/seed/ActuRegion/48/48",
    "likes": 600,
    "retweets": 350,
    "views": 80000
  },
  {
    "id": 10,
    "emitter": "Patient anxieux",
    "handle": "@sophie_malade",
    "message": "J’attends un traitement depuis 2h et on me dit que le système est « en panne ». On nous laisse sans explication.",
    "time": 55,
    "avatar": "https://picsum.photos/seed/sophie_malade/48/48",
    "likes": 90,
    "retweets": 25,
    "views": 4500
  },
  {
    "id": 11,
    "emitter": "Syndicat du personnel",
    "handle": "@SyndicatSante",
    "message": "Le personnel dénonce l’absence d’outils sûrs pour travailler en mode dégradé : risque important d’erreurs administratives et cliniques.",
    "time": 63,
    "avatar": "https://picsum.photos/seed/SyndicatSante/48/48",
    "likes": 1200,
    "retweets": 700,
    "views": 110000
  },
  {
    "id": 12,
    "emitter": "Parent d’un patient programmé au bloc",
    "handle": "@famille_rousseau",
    "message": "L’opération de ma femme reportée sans horaire de reprise. On nous dit seulement « problème informatique ». On stresse.",
    "time": 70,
    "avatar": "https://picsum.photos/seed/famille_rousseau/48/48",
    "likes": 180,
    "retweets": 40,
    "views": 9800
  },
  {
    "id": 13,
    "emitter": "Compte de rumeurs",
    "handle": "@on_parle",
    "message": "Info (non confirmée) : hôpital victime d’une cyberattaque, pare-feu pris en défaut. Les réseaux sociaux s’emballent.",
    "time": 75,
    "avatar": "https://picsum.photos/seed/on_parle/48/48",
    "likes": 2500,
    "retweets": 1800,
    "views": 250000
  },
  {
    "id": 14,
    "emitter": "Journal local (update)",
    "handle": "@InfosVille",
    "message": "Mise à jour : des patients ont été redirigés vers d’autres établissements. Longues files d’attente aux admissions.",
    "time": 82,
    "avatar": "https://picsum.photos/seed/InfosVille/48/48",
    "likes": 900,
    "retweets": 600,
    "views": 150000
  },
  {
    "id": 15,
    "emitter": "Association de patients",
    "handle": "@PatientsUnis",
    "message": "Nous demandons des réponses claires pour les patients affectés et des garanties sur la confidentialité des dossiers. Trop d’incertitude.",
    "time": 88,
    "avatar": "https://picsum.photos/seed/PatientsUnis/48/48",
    "likes": 1500,
    "retweets": 950,
    "views": 180000
  }
];

    // --- FROM components/PostForm.tsx ---
    const PostForm = ({ post, onSubmit, onCancel }) => {
        const [formData, setFormData] = useState({
            emitter: '',
            handle: '',
            message: '',
            time: 1,
        });

        useEffect(() => {
            if (post) {
                setFormData({
                    emitter: post.emitter,
                    handle: post.handle,
                    message: post.message,
                    time: post.time,
                });
            } else {
                setFormData({ emitter: '', handle: '', message: '', time: 1 });
            }
        }, [post]);

        const handleChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({ ...prev, [name]: name === 'time' ? parseInt(value, 10) || 0 : value }));
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            if (!formData.emitter.trim() || !formData.handle.trim() || !formData.message.trim() || formData.time <= 0) {
                alert('Veuillez remplir tous les champs. Le temps doit être un nombre supérieur à 0.');
                return;
            }
            if (post) {
                onSubmit({ ...post, ...formData });
            } else {
                onSubmit(formData);
            }
        };

        return (
            <form onSubmit={handleSubmit} className="bg-gray-700 p-4 rounded-lg space-y-4">
                 <h3 className="text-md font-semibold text-white">{post ? 'Modifier le message' : 'Ajouter un nouveau message'}</h3>
                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label htmlFor="emitter" className="block text-sm font-medium text-gray-300 mb-1">Émetteur</label>
                        <input type="text" name="emitter" id="emitter" value={formData.emitter} onChange={handleChange} required className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-white focus:ring-cyan-500 focus:border-cyan-500"/>
                    </div>
                     <div>
                        <label htmlFor="handle" className="block text-sm font-medium text-gray-300 mb-1">Handle</label>
                        <input type="text" name="handle" id="handle" value={formData.handle} onChange={handleChange} required placeholder="@username" className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-white focus:ring-cyan-500 focus:border-cyan-500"/>
                    </div>
                 </div>
                 <div>
                    <label htmlFor="time" className="block text-sm font-medium text-gray-300 mb-1">Moment (minutes)</label>
                    <input type="number" name="time" id="time" value={formData.time} onChange={handleChange} required min="1" className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-white focus:ring-cyan-500 focus:border-cyan-500"/>
                 </div>
                <div>
                    <label htmlFor="message" className="block text-sm font-medium text-gray-300 mb-1">Message</label>
                    <textarea name="message" id="message" value={formData.message} onChange={handleChange} required rows={4} className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-white focus:ring-cyan-500 focus:border-cyan-500"></textarea>
                </div>
                <div className="flex justify-end space-x-2">
                    <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-colors duration-200">Annuler</button>
                    <button type="submit" className="px-4 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-500 transition-colors duration-200">Enregistrer</button>
                </div>
            </form>
        );
    };

    // --- FROM components/PostManager.tsx ---
    const PostManager = ({ posts, onAddPost, onUpdatePost, onDeletePost }) => {
      const [editingPost, setEditingPost] = useState(null);
      const [isFormVisible, setIsFormVisible] = useState(false);
      const [isExportVisible, setIsExportVisible] = useState(false);
      const [copyButtonText, setCopyButtonText] = useState('Copier le code');

      const handleEdit = (post) => {
        setEditingPost(post);
        setIsFormVisible(true);
        setIsExportVisible(false);
      };

      const handleAddNew = () => {
        setEditingPost(null);
        setIsFormVisible(true);
        setIsExportVisible(false);
      };

      const handleCancelForm = () => {
        setIsFormVisible(false);
        setEditingPost(null);
      };
      
      const handleShowExport = () => {
        setIsExportVisible(true);
        setIsFormVisible(false);
      };
      
      const handleHideExport = () => {
        setIsExportVisible(false);
        setCopyButtonText('Copier le code');
      };

      const handleSubmitForm = (data) => {
        if ('id' in data) {
          onUpdatePost(data);
        } else {
          onAddPost(data);
        }
        setIsFormVisible(false);
        setEditingPost(null);
      };
      
      const generateExportCode = () => {
        const code = `const INITIAL_SCHEDULED_POSTS = ${JSON.stringify(posts, null, 2)};`;
        return code;
      };

      const handleCopyCode = () => {
        navigator.clipboard.writeText(generateExportCode()).then(() => {
          setCopyButtonText('Copié !');
          setTimeout(() => setCopyButtonText('Copier le code'), 2000);
        }, (err) => {
          console.error('Could not copy text: ', err);
          setCopyButtonText('Erreur');
        });
      };

      return (
        <div className="bg-gray-800 p-4 rounded-b-lg shadow-lg border border-t-0 border-gray-700">
          <div className="flex flex-wrap justify-between items-center mb-4 gap-2">
            <h2 className="text-lg font-semibold text-gray-300">Messages Programmés</h2>
            {!isFormVisible && !isExportVisible && (
              <div className="flex space-x-2">
                <button 
                  onClick={handleShowExport}
                  className="px-3 py-1 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-500 transition-colors duration-200 text-sm"
                >
                  Exporter pour GitHub
                </button>
                <button 
                  onClick={handleAddNew} 
                  className="px-3 py-1 bg-cyan-600 text-white font-bold rounded-md hover:bg-cyan-500 transition-colors duration-200 text-sm"
                >
                  Ajouter
                </button>
              </div>
            )}
          </div>

          {isFormVisible ? (
            <PostForm post={editingPost} onSubmit={handleSubmitForm} onCancel={handleCancelForm} />
          ) : isExportVisible ? (
            <div className="bg-gray-700 p-4 rounded-lg space-y-4">
                <h3 className="text-md font-semibold text-white">Exporter la configuration</h3>
                <p className="text-sm text-gray-400">Copiez ce code et remplacez la variable <code>INITIAL_SCHEDULED_POSTS</code> dans votre fichier <code>index.html</code> sur GitHub.</p>
                <textarea 
                    readOnly 
                    className="w-full h-48 bg-gray-900 text-cyan-300 font-mono text-xs p-2 rounded-md border border-gray-600 focus:outline-none"
                    value={generateExportCode()}
                ></textarea>
                <div className="flex justify-end space-x-2">
                    <button onClick={handleHideExport} className="px-4 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-colors duration-200">Fermer</button>
                    <button onClick={handleCopyCode} className="px-4 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-500 transition-colors duration-200 w-32">{copyButtonText}</button>
                </div>
            </div>
          ) : (
            <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
              {posts.map(post => (
                <div key={post.id} className="bg-gray-700/50 p-3 rounded-md flex justify-between items-start gap-4">
                  <div className="flex-1 min-w-0">
                    <p className="font-bold text-white">{post.emitter} <span className="text-gray-400 font-normal">{post.handle}</span></p>
                    <p className="text-sm text-gray-300 break-words">{post.message}</p>
                    <p className="text-xs text-cyan-400 mt-1">Minute: {post.time}</p>
                  </div>
                  <div className="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 flex-shrink-0">
                    <button onClick={() => handleEdit(post)} className="px-3 py-1 text-xs bg-yellow-600 text-white font-bold rounded hover:bg-yellow-500 transition-colors">Éditer</button>
                    <button onClick={() => onDeletePost(post.id)} className="px-3 py-1 text-xs bg-red-700 text-white font-bold rounded hover:bg-red-600 transition-colors">Supprimer</button>
                  </div>
                </div>
              ))}
               {posts.length === 0 && (
                <p className="text-center text-gray-500 py-4">Aucun message programmé.</p>
              )}
            </div>
          )}
        </div>
      );
    };

    // --- FROM components/Post.tsx ---
    const Post = ({ post }) => {
      const formatNumber = (num) => {
        if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
        return String(num);
      };

      const [engagement, setEngagement] = useState({
        likes: post.likes,
        retweets: post.retweets,
        views: post.views,
      });

      useEffect(() => {
        const interval = setInterval(() => {
          setEngagement(prev => ({
            likes: prev.likes + Math.floor(Math.random() * 3),
            retweets: prev.retweets + (Math.random() > 0.5 ? 1 : 0),
            views: prev.views + Math.floor(Math.random() * 25) + 5,
          }));
        }, 2000 + Math.random() * 1000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="p-4 border-b border-gray-700 last:border-b-0 hover:bg-gray-700/50 transition-colors duration-200 flex space-x-4">
          <div className="flex-shrink-0">
            <img src={post.avatar} alt={`Avatar for ${post.handle}`} className="w-12 h-12 rounded-full bg-gray-600" />
          </div>
          <div className="flex-1">
            <div className="flex items-baseline space-x-2">
              <span className="font-bold text-white">{post.emitter}</span>
              <span className="text-sm text-gray-400">{post.handle}</span>
              <span className="text-sm text-gray-500">·</span>
              <span className="text-sm text-gray-500">Minute {post.time}</span>
            </div>
            <p className="mt-1 text-gray-200 whitespace-pre-wrap">{post.message}</p>
            <div className="mt-3 flex items-center space-x-6 text-gray-500">
              <div className="flex items-center space-x-2 group cursor-pointer">
                 <svg className="w-5 h-5 group-hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                 <span className="text-sm group-hover:text-red-500 transition-colors">{formatNumber(engagement.likes)}</span>
              </div>
               <div className="flex items-center space-x-2 group cursor-pointer">
                <svg className="w-5 h-5 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13" /></svg>
                <span className="text-sm group-hover:text-green-500 transition-colors">{formatNumber(engagement.retweets)}</span>
              </div>
              <div className="flex items-center space-x-2 group cursor-pointer">
                <svg className="w-5 h-5 group-hover:text-cyan-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                <span className="text-sm group-hover:text-cyan-500 transition-colors">{formatNumber(engagement.views)}</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // --- FROM components/Timeline.tsx ---
    const Timeline = ({ posts }) => {
      return (
        <div className="max-w-2xl mx-auto">
          <h2 className="text-lg font-semibold text-gray-400 mb-4 px-2">Timeline des événements</h2>
          <div className="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
            <div className="flex flex-col-reverse">
              {[...posts].map(post => <Post key={post.id} post={post} />)}
            </div>
          </div>
        </div>
      );
    };
    
    // --- FROM components/AdminPanel.tsx ---
    const AdminPanel = ({ status, elapsedTime, speed, onStart, onPause, onResume, onReset, onSpeedChange }) => {
      const formatTime = (totalSeconds) => {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = Math.floor(totalSeconds % 60);
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      };
      const SPEED_OPTIONS = [1, 10, 60, 100];

      return (
        <div className="bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-700 flex flex-wrap justify-between items-center gap-4">
          <div className="flex items-center space-x-4">
            <span className="text-gray-400 font-semibold hidden sm:inline">Temps:</span>
            <span className="text-2xl font-mono bg-gray-900 px-3 py-1 rounded-md text-cyan-400 tracking-wider">
              {formatTime(elapsedTime)}
            </span>
          </div>
          <div className="flex items-center space-x-2">
             <span className="text-gray-400 text-sm mr-2 hidden sm:inline">Vitesse:</span>
             {SPEED_OPTIONS.map(s => (
                <button 
                    key={s} 
                    onClick={() => onSpeedChange(s)} 
                    className={`px-3 py-1 text-sm font-bold rounded-md transition-colors duration-200 ${speed === s ? 'bg-cyan-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                    aria-pressed={speed === s}
                >
                    x{s}
                </button>
             ))}
          </div>
          <div className="flex items-center space-x-2">
            {status === SimulationStatus.Stopped && (
              <button onClick={onStart} className="px-4 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-500 transition-colors duration-200">Démarrer</button>
            )}
            {status === SimulationStatus.Finished && (
              <button disabled className="px-4 py-2 bg-gray-600 text-white font-bold rounded-md cursor-not-allowed">Terminé</button>
            )}
            {status === SimulationStatus.Running && (
              <button onClick={onPause} className="px-4 py-2 bg-yellow-600 text-white font-bold rounded-md hover:bg-yellow-500 transition-colors duration-200">Pause</button>
            )}
            {status === SimulationStatus.Paused && (
              <button onClick={onResume} className="px-4 py-2 bg-green-600 text-white font-bold rounded-md hover:bg-green-500 transition-colors duration-200">Reprendre</button>
            )}
            {(status !== SimulationStatus.Stopped) && (
              <button onClick={onReset} className="px-4 py-2 bg-red-700 text-white font-bold rounded-md hover:bg-red-600 transition-colors duration-200">Réinitialiser</button>
            )}
          </div>
        </div>
      );
    };

    // --- FROM App.tsx ---
    function App() {
      const [simulationStatus, setSimulationStatus] = useState(SimulationStatus.Stopped);
      const [elapsedTime, setElapsedTime] = useState(0); // in seconds
      const [visiblePosts, setVisiblePosts] = useState([]);
      const [scheduledPosts, setScheduledPosts] = useState(INITIAL_SCHEDULED_POSTS);
      const [speed, setSpeed] = useState(1);
      const [isManagerVisible, setIsManagerVisible] = useState(false);
      const prevPostCount = useRef(0);
      const audioContextRef = useRef(null);

      const playNotificationSound = useCallback(() => {
        if (typeof window !== 'undefined' && !audioContextRef.current) {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }
        const audioContext = audioContextRef.current;
        if (audioContext) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.5);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
      }, []);

      const SIMULATION_DURATION_SECONDS = 90 * 60;

      useEffect(() => {
        let timerId;
        if (simulationStatus === SimulationStatus.Running) {
          timerId = window.setInterval(() => {
            setElapsedTime(prevTime => {
                const newTime = prevTime + (1 * speed);
                if (newTime >= SIMULATION_DURATION_SECONDS) {
                    setSimulationStatus(SimulationStatus.Finished);
                    return SIMULATION_DURATION_SECONDS;
                }
                return newTime;
            });
          }, 1000);
        }
        return () => clearInterval(timerId);
      }, [simulationStatus, speed]);

      useEffect(() => {
        const postsToShow = scheduledPosts.filter(post => (post.time * 60) <= elapsedTime);
        if (postsToShow.length > prevPostCount.current) {
          setVisiblePosts(postsToShow);
          if (simulationStatus === SimulationStatus.Running) {
              playNotificationSound();
          }
        }
        prevPostCount.current = postsToShow.length;
      }, [elapsedTime, scheduledPosts, simulationStatus, playNotificationSound]);

      const handleStart = useCallback(() => setSimulationStatus(SimulationStatus.Running), []);
      const handlePause = useCallback(() => setSimulationStatus(SimulationStatus.Paused), []);
      const handleResume = useCallback(() => setSimulationStatus(SimulationStatus.Running), []);
      const handleReset = useCallback(() => {
        setSimulationStatus(SimulationStatus.Stopped);
        setElapsedTime(0);
        setVisiblePosts([]);
        setScheduledPosts(INITIAL_SCHEDULED_POSTS);
        setSpeed(1);
        prevPostCount.current = 0;
      }, []);
      const handleSpeedChange = useCallback((newSpeed) => setSpeed(newSpeed), []);

      const handleAddPost = useCallback((postData) => {
        const newPost = {
            ...postData,
            id: Date.now(),
            avatar: `https://picsum.photos/seed/${postData.handle}/48/48`,
            likes: 0, retweets: 0, views: 0
        };
        setScheduledPosts(prevPosts => [...prevPosts, newPost].sort((a,b) => a.time - b.time));
      }, []);
      
      const handleUpdatePost = useCallback((updatedPost) => {
        setScheduledPosts(prevPosts => 
            prevPosts.map(p => p.id === updatedPost.id ? updatedPost : p).sort((a,b) => a.time - b.time)
        );
      }, []);

      const handleDeletePost = useCallback((postId) => {
        setScheduledPosts(prevPosts => prevPosts.filter(p => p.id !== postId));
      }, []);

      return (
        <div className="min-h-screen bg-gray-900 text-gray-100 font-sans">
          <header className="bg-gray-800/80 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-10 p-4">
            <div className="container mx-auto flex justify-between items-center">
              <h1 className="text-xl md:text-2xl font-bold text-cyan-400">Cybersecurity Crisis Simulator</h1>
            </div>
          </header>
          
          <main className="container mx-auto p-4 md:p-6">
            <AdminPanel
              status={simulationStatus}
              elapsedTime={elapsedTime}
              speed={speed}
              onStart={handleStart} onPause={handlePause} onResume={handleResume} onReset={handleReset}
              onSpeedChange={handleSpeedChange}
            />
            <div className="mt-6">
              <Timeline posts={visiblePosts} />
            </div>
            <div className="mt-6">
                <div className="max-w-4xl mx-auto">
                    <button 
                        onClick={() => setIsManagerVisible(!isManagerVisible)}
                        className="w-full text-left p-3 bg-gray-800 border border-gray-700 rounded-t-lg hover:bg-gray-700 focus:outline-none flex justify-between items-center"
                        aria-expanded={isManagerVisible}
                        aria-controls="post-manager"
                    >
                        <span className="font-semibold">Gestion des Messages</span>
                        <svg className={`w-5 h-5 transition-transform duration-300 ${isManagerVisible ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    {isManagerVisible && (
                         <div id="post-manager">
                            <PostManager
                                posts={scheduledPosts}
                                onAddPost={handleAddPost}
                                onUpdatePost={handleUpdatePost}
                                onDeletePost={handleDeletePost}
                            />
                         </div>
                    )}
                </div>
            </div>
          </main>

          <footer className="text-center p-4 text-gray-500 text-sm">
            <p>Built for cybersecurity training purposes.</p>
          </footer>
        </div>
      );
    }

    // --- FROM index.tsx ---
    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);

  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
